<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>TermData.hpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>TermData.hpp</h1><a href="TermData_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*==========================================================================</font>
00002 <font class="comment">  Copyright (c) 2004 University of Massachusetts.  All Rights Reserved.</font>
00003 <font class="comment"></font>
00004 <font class="comment">  Use of the Lemur Toolkit for Language Modeling and Information Retrieval</font>
00005 <font class="comment">  is subject to the terms of the software license set forth in the LICENSE</font>
00006 <font class="comment">  file included with this software, and also available at</font>
00007 <font class="comment">  http://www.cs.cmu.edu/~lemur/license.html </font>
00008 <font class="comment">  as well as the conditions below.</font>
00009 <font class="comment"></font>
00010 <font class="comment">  Redistribution and use in source and binary forms, with or without</font>
00011 <font class="comment">  modification, are permitted provided that the following conditions</font>
00012 <font class="comment">  are met:</font>
00013 <font class="comment"></font>
00014 <font class="comment">  1. Redistributions of source code must retain the above copyright</font>
00015 <font class="comment">  notice, this list of conditions and the following disclaimer.</font>
00016 <font class="comment"></font>
00017 <font class="comment">  2. Redistributions in binary form must reproduce the above copyright</font>
00018 <font class="comment">  notice, this list of conditions and the following disclaimer in</font>
00019 <font class="comment">  the documentation and/or other materials provided with the</font>
00020 <font class="comment">  distribution.</font>
00021 <font class="comment"></font>
00022 <font class="comment">  3. The names "Indri", "Center for Intelligent Information Retrieval", </font>
00023 <font class="comment">  "CIIR", and "University of Massachusetts" must not be used to</font>
00024 <font class="comment">  endorse or promote products derived from this software without</font>
00025 <font class="comment">  prior written permission. To obtain permission, contact</font>
00026 <font class="comment">  indri-info@ciir.cs.umass.edu.</font>
00027 <font class="comment"></font>
00028 <font class="comment">  4. Products derived from this software may not be called "Indri" nor </font>
00029 <font class="comment">  may "Indri" appear in their names without prior written permission of </font>
00030 <font class="comment">  the University of Massachusetts. To obtain permission, contact </font>
00031 <font class="comment">  indri-info@ciir.cs.umass.edu.</font>
00032 <font class="comment"></font>
00033 <font class="comment">  THIS SOFTWARE IS PROVIDED BY THE UNIVERSITY OF MASSACHUSETTS AND OTHER</font>
00034 <font class="comment">  CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,</font>
00035 <font class="comment">  BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND</font>
00036 <font class="comment">  FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL</font>
00037 <font class="comment">  THE COPYRIGHT HOLDERS OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,</font>
00038 <font class="comment">  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,</font>
00039 <font class="comment">  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS</font>
00040 <font class="comment">  OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED</font>
00041 <font class="comment">  AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR</font>
00042 <font class="comment">  TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF</font>
00043 <font class="comment">  THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH</font>
00044 <font class="comment">  DAMAGE.</font>
00045 <font class="comment">  ==========================================================================</font>
00046 <font class="comment">*/</font>
00047 
00048 
00049 <font class="comment">//</font>
00050 <font class="comment">// TermData.hpp</font>
00051 <font class="comment">//</font>
00052 <font class="comment">// 4 February 2004 -- tds</font>
00053 <font class="comment">//</font>
00054 
00055 <font class="preprocessor">#ifndef INDRI_TERMDATA_HPP</font>
00056 <font class="preprocessor"></font><font class="preprocessor">#define INDRI_TERMDATA_HPP</font>
00057 <font class="preprocessor"></font>
00058 <font class="preprocessor">#include "<a class="code" href="TermFieldStatistics_8hpp.html">indri/TermFieldStatistics.hpp</a>"</font>
00059 <font class="preprocessor">#include &lt;indri/greedy_vector&gt;</font>
00060 <font class="preprocessor">#include "<a class="code" href="DocListMemoryBuilder_8hpp.html">indri/DocListMemoryBuilder.hpp</a>"</font>
00061 <font class="preprocessor">#include "lemur/File.hpp"</font>
00062 <font class="preprocessor">#include "lemur/lemur-compat.hpp"</font>
00063 <font class="preprocessor">#include "<a class="code" href="RVLCompressStream_8hpp.html">indri/RVLCompressStream.hpp</a>"</font>
00064 <font class="preprocessor">#include "<a class="code" href="RVLDecompressStream_8hpp.html">indri/RVLDecompressStream.hpp</a>"</font>
00065 
00066 <font class="preprocessor">#ifdef WIN32</font>
00067 <font class="preprocessor"></font><font class="comment">// remove warning about zero-sized arrays</font>
00068 <font class="preprocessor">#pragma warning ( disable: 4200 )</font>
00069 <font class="preprocessor"></font><font class="preprocessor">#endif </font>
00070 <font class="preprocessor"></font>
<a name="l00071"></a><a class="code" href="TermData_8hpp.html#a0">00071</a> <font class="preprocessor">#define INDRI_MAX_SEGMENTS (8)</font>
00072 <font class="preprocessor"></font>
00073 <font class="keyword">namespace </font>indri {
00074   <font class="keyword">namespace </font>index {
<a name="l00075"></a><a class="code" href="structindri_1_1index_1_1TermData.html">00075</a>     <font class="keyword">struct </font><a class="code" href="structindri_1_1index_1_1TermData.html">TermData</a> {
00076     <font class="keyword">private</font>:
00077       <font class="comment">// these are private, bogus functions so that this object can never be copied</font>
00078       <font class="comment">// we don't want to be able to copy it, because any real copy operator needs to</font>
00079       <font class="comment">// take into account the data in the fields[] array, and we don't know how long it is.</font>
<a name="l00080"></a><a class="code" href="structindri_1_1index_1_1TermData.html#c0">00080</a>       <a class="code" href="structindri_1_1index_1_1TermData.html#a0">TermData</a>( <font class="keyword">const</font> <a class="code" href="structindri_1_1index_1_1TermData.html">TermData</a>&amp; other ) {}
<a name="l00081"></a><a class="code" href="structindri_1_1index_1_1TermData.html#c1">00081</a>       <font class="keyword">const</font> <a class="code" href="structindri_1_1index_1_1TermData.html">TermData</a>&amp; <a class="code" href="structindri_1_1index_1_1TermData.html#c1">operator= </a>( <font class="keyword">const</font> <a class="code" href="structindri_1_1index_1_1TermData.html">TermData</a>&amp; other ) { <font class="keywordflow">return</font> *<font class="keyword">this</font>; }
00082 
00083     <font class="keyword">public</font>:
<a name="l00084"></a><a class="code" href="structindri_1_1index_1_1TermData.html#a0">00084</a>       <a class="code" href="structindri_1_1index_1_1TermData.html#a0">TermData</a>() :
00085           <a class="code" href="structindri_1_1index_1_1TermData.html#m4">maxDocumentFrequency</a>(0),
00086           <a class="code" href="structindri_1_1index_1_1TermData.html#m3">maxDocumentFraction</a>(0),
00087           <a class="code" href="structindri_1_1index_1_1TermData.html#m5">minDocumentLength</a>(MAX_INT32)
00088       {
00089         <a class="code" href="structindri_1_1index_1_1TermData.html#m6">term</a> = 0;
00090         
00091         memset( <a class="code" href="structindri_1_1index_1_1TermData.html#m0">segmentOffsets</a>, 0xFF, <font class="keyword">sizeof</font> <a class="code" href="structindri_1_1index_1_1TermData.html#m0">segmentOffsets</a> );
00092       }
00093 
<a name="l00094"></a><a class="code" href="structindri_1_1index_1_1TermData.html#m0">00094</a>       File::offset_type <a class="code" href="structindri_1_1index_1_1TermData.html#m0">segmentOffsets</a>[<a class="code" href="TermData_8hpp.html#a0">INDRI_MAX_SEGMENTS</a>];
<a name="l00095"></a><a class="code" href="structindri_1_1index_1_1TermData.html#m1">00095</a>       <a class="code" href="structindri_1_1index_1_1TermFieldStatistics.html">TermFieldStatistics</a> <a class="code" href="structindri_1_1index_1_1TermData.html#m1">corpus</a>;
<a name="l00096"></a><a class="code" href="structindri_1_1index_1_1TermData.html#m2">00096</a>       <a class="code" href="classindri_1_1index_1_1DocListMemoryBuilder.html">DocListMemoryBuilder</a> <a class="code" href="structindri_1_1index_1_1TermData.html#m2">list</a>;
00097 
<a name="l00098"></a><a class="code" href="structindri_1_1index_1_1TermData.html#m3">00098</a>       <font class="keywordtype">float</font> <a class="code" href="structindri_1_1index_1_1TermData.html#m3">maxDocumentFraction</a>;         <font class="comment">// argmax_documents of (termCount/docLength)</font>
<a name="l00099"></a><a class="code" href="structindri_1_1index_1_1TermData.html#m4">00099</a>       <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> <a class="code" href="structindri_1_1index_1_1TermData.html#m4">maxDocumentFrequency</a>; <font class="comment">// maximum number of times this term appears in any given document</font>
<a name="l00100"></a><a class="code" href="structindri_1_1index_1_1TermData.html#m5">00100</a>       <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> <a class="code" href="structindri_1_1index_1_1TermData.html#m5">minDocumentLength</a>;    <font class="comment">// minimum length of any document that contains this term</font>
00101 
<a name="l00102"></a><a class="code" href="structindri_1_1index_1_1TermData.html#m6">00102</a>       <font class="keyword">const</font> <font class="keywordtype">char</font>* <a class="code" href="structindri_1_1index_1_1TermData.html#m6">term</a>;                  <font class="comment">// name of this term</font>
00103 
<a name="l00104"></a><a class="code" href="structindri_1_1index_1_1TermData.html#m7">00104</a>       <a class="code" href="structindri_1_1index_1_1TermFieldStatistics.html">TermFieldStatistics</a> <a class="code" href="structindri_1_1index_1_1TermData.html#m7">fields</a>[0];
00105     };
00106   }
00107 }
00108 
<a name="l00109"></a><a class="code" href="TermData_8hpp.html#a1">00109</a> <font class="keyword">inline</font> <a class="code" href="structindri_1_1index_1_1TermData.html">indri::index::TermData</a>* <a class="code" href="TermData_8hpp.html#a1">termdata_create</a>( <font class="keywordtype">int</font> fieldCount ) {
00110   <font class="comment">// allocate enough room for the term data, plus enough room for fields</font>
00111   <font class="keywordtype">void</font>* buffer = malloc( <font class="keyword">sizeof</font>(<a class="code" href="structindri_1_1index_1_1TermData.html">indri::index::TermData</a>) + <font class="keyword">sizeof</font>(<a class="code" href="structindri_1_1index_1_1TermFieldStatistics.html">indri::index::TermFieldStatistics</a>)*fieldCount );
00112   
00113   <font class="comment">// call the constructor in place</font>
00114   <font class="keyword">new</font>(buffer) <a class="code" href="structindri_1_1index_1_1TermData.html">indri::index::TermData</a>();
00115 
00116   <font class="comment">// call field data constructors in place</font>
00117   <font class="keywordflow">for</font>( <font class="keywordtype">int</font> i=0; i&lt;fieldCount; i++ ) {
00118     <font class="keyword">new</font>((<font class="keywordtype">char</font>*)buffer +
00119         <font class="keyword">sizeof</font>(indri::index::TermData) +
00120         <font class="keyword">sizeof</font>(indri::index::TermFieldStatistics)*i) <a class="code" href="structindri_1_1index_1_1TermFieldStatistics.html">indri::index::TermFieldStatistics</a>();
00121   }
00122 
00123   <font class="keywordflow">return</font> (<a class="code" href="structindri_1_1index_1_1TermData.html">indri::index::TermData</a>*) buffer;
00124 }
00125 
<a name="l00126"></a><a class="code" href="TermData_8hpp.html#a2">00126</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> <a class="code" href="TermData_8hpp.html#a2">termdata_delete</a>( <a class="code" href="structindri_1_1index_1_1TermData.html">indri::index::TermData</a>* termData, <font class="keywordtype">int</font> fieldCount ) {
00127   <font class="keywordflow">if</font>( termData ) {
00128     termData-&gt;~TermData();
00129 
00130     <font class="keywordflow">for</font>( <font class="keywordtype">int</font> i=0; i&lt;fieldCount; i++ ) {
00131       termData-&gt;<a class="code" href="structindri_1_1index_1_1TermData.html#m7">fields</a>[i].~TermFieldStatistics();
00132     }
00133 
00134     free(termData);
00135   }
00136 }
00137 
<a name="l00138"></a><a class="code" href="TermData_8hpp.html#a3">00138</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> <a class="code" href="TermData_8hpp.html#a3">termdata_size</a>( <font class="keywordtype">int</font> fieldCount ) {
00139   <font class="keywordflow">return</font> <font class="keyword">sizeof</font>(indri::index::TermData) + fieldCount * <font class="keyword">sizeof</font>(indri::index::TermFieldStatistics);
00140 }
00141 
<a name="l00142"></a><a class="code" href="TermData_8hpp.html#a4">00142</a> <font class="keyword">inline</font> <font class="keywordtype">int</font> <a class="code" href="TermData_8hpp.html#a4">termdata_compress</a>( <font class="keywordtype">char</font>* buffer, <font class="keywordtype">int</font> size, <font class="keywordtype">int</font> fieldCount, <a class="code" href="structindri_1_1index_1_1TermData.html">indri::index::TermData</a>* termData ) {
00143   <a class="code" href="classRVLCompressStream.html">RVLCompressStream</a> stream( buffer, size );
00144 
00145   <font class="comment">// corpus statistics</font>
00146   stream &lt;&lt; termData-&gt;<a class="code" href="structindri_1_1index_1_1TermData.html#m1">corpus</a>.totalCount
00147          &lt;&lt; termData-&gt;<a class="code" href="structindri_1_1index_1_1TermData.html#m1">corpus</a>.documentCount;
00148 
00149   <font class="comment">// max-score statistics</font>
00150   stream &lt;&lt; termData-&gt;<a class="code" href="structindri_1_1index_1_1TermData.html#m4">maxDocumentFrequency</a>
00151          &lt;&lt; termData-&gt;<a class="code" href="structindri_1_1index_1_1TermData.html#m5">minDocumentLength</a>
00152          &lt;&lt; termData-&gt;<a class="code" href="structindri_1_1index_1_1TermData.html#m3">maxDocumentFraction</a>;
00153 
00154   <font class="comment">// segment information</font>
00155   
00156   <font class="keywordtype">int</font> numSegments = 0;
00157 
00158   <font class="comment">// count up the number of segments used here</font>
00159   <font class="keywordflow">for</font>( size_t i=0; i&lt;<a class="code" href="TermData_8hpp.html#a0">INDRI_MAX_SEGMENTS</a>; i++ ) {
00160     <font class="keywordflow">if</font>( termData-&gt;<a class="code" href="structindri_1_1index_1_1TermData.html#m0">segmentOffsets</a>[i] != (INT64) (-1) )
00161       numSegments++;
00162   }
00163 
00164   stream &lt;&lt; numSegments;
00165 
00166   <font class="comment">// stream out only the segment offsets that are used</font>
00167   <font class="keywordflow">for</font>( <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> i=0; i&lt;<a class="code" href="TermData_8hpp.html#a0">INDRI_MAX_SEGMENTS</a>; i++ ) {
00168     <font class="keywordflow">if</font>( termData-&gt;<a class="code" href="structindri_1_1index_1_1TermData.html#m0">segmentOffsets</a>[i] != (INT64) (-1) ) {
00169       stream &lt;&lt; i
00170              &lt;&lt; termData-&gt;<a class="code" href="structindri_1_1index_1_1TermData.html#m0">segmentOffsets</a>[i];
00171     }
00172   }
00173 
00174   <font class="comment">// field statistics</font>
00175   <font class="keywordflow">for</font>( <font class="keywordtype">int</font> i=0; i&lt;fieldCount; i++ ) {
00176     stream &lt;&lt; termData-&gt;<a class="code" href="structindri_1_1index_1_1TermData.html#m7">fields</a>[i].totalCount
00177           &lt;&lt; termData-&gt;<a class="code" href="structindri_1_1index_1_1TermData.html#m7">fields</a>[i].documentCount;
00178   }
00179 
00180   <font class="keywordflow">return</font> stream.<a class="code" href="classRVLCompressStream.html#a2">dataSize</a>();
00181 }
00182 
<a name="l00183"></a><a class="code" href="TermData_8hpp.html#a5">00183</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> <a class="code" href="TermData_8hpp.html#a5">termdata_decompress</a>( <font class="keyword">const</font> <font class="keywordtype">char</font>* buffer, <font class="keywordtype">int</font> size, <font class="keywordtype">int</font> fieldCount, <a class="code" href="structindri_1_1index_1_1TermData.html">indri::index::TermData</a>* termData ) {
00184   <a class="code" href="classRVLDecompressStream.html">RVLDecompressStream</a> stream( buffer, size );
00185   
00186   <font class="comment">// corpus statistics</font>
00187   stream &gt;&gt; termData-&gt;<a class="code" href="structindri_1_1index_1_1TermData.html#m1">corpus</a>.totalCount
00188          &gt;&gt; termData-&gt;<a class="code" href="structindri_1_1index_1_1TermData.html#m1">corpus</a>.documentCount;
00189 
00190   <font class="comment">// max-score statistics</font>
00191   stream &gt;&gt; termData-&gt;<a class="code" href="structindri_1_1index_1_1TermData.html#m4">maxDocumentFrequency</a>
00192          &gt;&gt; termData-&gt;<a class="code" href="structindri_1_1index_1_1TermData.html#m5">minDocumentLength</a>
00193          &gt;&gt; termData-&gt;<a class="code" href="structindri_1_1index_1_1TermData.html#m3">maxDocumentFraction</a>;
00194 
00195   <font class="comment">// segment information</font>
00196   <font class="keywordtype">int</font> numSegments = 0;
00197   stream &gt;&gt; numSegments;
00198 
00199   <font class="keywordflow">for</font>( <font class="keywordtype">int</font> i=0; i&lt;numSegments; i++ ) {
00200     <font class="keywordtype">int</font> segment;
00201     File::offset_type offset;
00202 
00203     stream &gt;&gt; segment
00204            &gt;&gt; offset;
00205 
00206     termData-&gt;<a class="code" href="structindri_1_1index_1_1TermData.html#m0">segmentOffsets</a>[segment] = offset;
00207   }
00208 
00209   <font class="comment">// field statistics</font>
00210   <font class="keywordflow">for</font>( <font class="keywordtype">int</font> i=0; i&lt;fieldCount; i++ ) {
00211     stream &gt;&gt; termData-&gt;<a class="code" href="structindri_1_1index_1_1TermData.html#m7">fields</a>[i].totalCount
00212            &gt;&gt; termData-&gt;<a class="code" href="structindri_1_1index_1_1TermData.html#m7">fields</a>[i].documentCount;
00213   }
00214 }
00215 
00216 <font class="preprocessor">#endif // INDRI_TERMDATA_HPP</font>
</pre></div><hr><address align="right"><small>Generated on Tue Nov 16 15:17:23 2004 for INDRI by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.16 </small></address>
</body>
</html>
