<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>IndriIndex.hpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>IndriIndex.hpp</h1><a href="IndriIndex_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*==========================================================================</font>
00002 <font class="comment">  Copyright (c) 2004 University of Massachusetts.  All Rights Reserved.</font>
00003 <font class="comment"></font>
00004 <font class="comment">  Use of the Lemur Toolkit for Language Modeling and Information Retrieval</font>
00005 <font class="comment">  is subject to the terms of the software license set forth in the LICENSE</font>
00006 <font class="comment">  file included with this software, and also available at</font>
00007 <font class="comment">  http://www.cs.cmu.edu/~lemur/license.html </font>
00008 <font class="comment">  as well as the conditions below.</font>
00009 <font class="comment"></font>
00010 <font class="comment">  Redistribution and use in source and binary forms, with or without</font>
00011 <font class="comment">  modification, are permitted provided that the following conditions</font>
00012 <font class="comment">  are met:</font>
00013 <font class="comment"></font>
00014 <font class="comment">  1. Redistributions of source code must retain the above copyright</font>
00015 <font class="comment">  notice, this list of conditions and the following disclaimer.</font>
00016 <font class="comment"></font>
00017 <font class="comment">  2. Redistributions in binary form must reproduce the above copyright</font>
00018 <font class="comment">  notice, this list of conditions and the following disclaimer in</font>
00019 <font class="comment">  the documentation and/or other materials provided with the</font>
00020 <font class="comment">  distribution.</font>
00021 <font class="comment"></font>
00022 <font class="comment">  3. The names "Indri", "Center for Intelligent Information Retrieval", </font>
00023 <font class="comment">  "CIIR", and "University of Massachusetts" must not be used to</font>
00024 <font class="comment">  endorse or promote products derived from this software without</font>
00025 <font class="comment">  prior written permission. To obtain permission, contact</font>
00026 <font class="comment">  indri-info@ciir.cs.umass.edu.</font>
00027 <font class="comment"></font>
00028 <font class="comment">  4. Products derived from this software may not be called "Indri" nor </font>
00029 <font class="comment">  may "Indri" appear in their names without prior written permission of </font>
00030 <font class="comment">  the University of Massachusetts. To obtain permission, contact </font>
00031 <font class="comment">  indri-info@ciir.cs.umass.edu.</font>
00032 <font class="comment"></font>
00033 <font class="comment">  THIS SOFTWARE IS PROVIDED BY THE UNIVERSITY OF MASSACHUSETTS AND OTHER</font>
00034 <font class="comment">  CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,</font>
00035 <font class="comment">  BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND</font>
00036 <font class="comment">  FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL</font>
00037 <font class="comment">  THE COPYRIGHT HOLDERS OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,</font>
00038 <font class="comment">  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,</font>
00039 <font class="comment">  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS</font>
00040 <font class="comment">  OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED</font>
00041 <font class="comment">  AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR</font>
00042 <font class="comment">  TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF</font>
00043 <font class="comment">  THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH</font>
00044 <font class="comment">  DAMAGE.</font>
00045 <font class="comment">  ==========================================================================</font>
00046 <font class="comment">*/</font>
00047 
00048 <font class="comment">/*==========================================================================</font>
00049 <font class="comment"> * Copyright (c) 2001 Carnegie Mellon University.  All Rights Reserved.</font>
00050 <font class="comment"> *</font>
00051 <font class="comment"> * Use of the Lemur Toolkit for Language Modeling and Information Retrieval</font>
00052 <font class="comment"> * is subject to the terms of the software license set forth in the LICENSE</font>
00053 <font class="comment"> * file included with this software, and also available at</font>
00054 <font class="comment"> * http://www.cs.cmu.edu/~lemur/license.html</font>
00055 <font class="comment"> *</font>
00056 <font class="comment"> *==========================================================================</font>
00057 <font class="comment">*/</font>
00058 
00059 
00060 <font class="preprocessor">#ifndef INDRI_INDEX_HPP</font>
00061 <font class="preprocessor"></font><font class="preprocessor">#define INDRI_INDEX_HPP</font>
00062 <font class="preprocessor"></font>
00063 <font class="comment">/*</font>
00064 <font class="comment"> * NAME DATE - COMMENTS</font>
00065 <font class="comment"> * tnt 01/02 - created</font>
00066 <font class="comment"> * dmf 07/03 - converted to incremental berkeley db btree indexer with</font>
00067 <font class="comment"> * integrated document manager.</font>
00068 <font class="comment"> * tds 09/03 - modified from BTIncIndex to use keyfile</font>
00069 <font class="comment">*/</font>
00070 
00071 <font class="preprocessor">#include "lemur/TermInfoList.hpp"</font>
00072 <font class="preprocessor">#include "lemur/DocInfoList.hpp"</font>
00073 <font class="preprocessor">#include "lemur/lemur-platform.h"</font>
00074 <font class="preprocessor">#include "lemur/lemur-compat.hpp"</font>
00075 <font class="preprocessor">#include "<a class="code" href="DocPositionInfoList_8hpp.html">indri/DocPositionInfoList.hpp</a>"</font>
00076 <font class="preprocessor">#include "lemur/Exception.hpp"</font>
00077 <font class="preprocessor">#include "lemur/Keyfile.hpp"</font>
00078 <font class="preprocessor">#include "lemur/ReadBuffer.hpp"</font>
00079 <font class="preprocessor">#include "lemur/WriteBuffer.hpp"</font>
00080 
00081 <font class="preprocessor">#include &lt;queue&gt;</font>
00082 <font class="preprocessor">#include &lt;map&gt;</font>
00083 
00084 <font class="preprocessor">#include "<a class="code" href="DocListMemoryBuilder_8hpp.html">indri/DocListMemoryBuilder.hpp</a>"</font>
00085 <font class="preprocessor">#include "<a class="code" href="DocListDiskBuilder_8hpp.html">indri/DocListDiskBuilder.hpp</a>"</font>
00086 <font class="preprocessor">#include "<a class="code" href="HashTable_8hpp.html">indri/HashTable.hpp</a>"</font>
00087 <font class="preprocessor">#include &lt;indri/greedy_vector&gt;</font>
00088 
00089 <font class="preprocessor">#include "<a class="code" href="TermData_8hpp.html">indri/TermData.hpp</a>"</font>
00090 <font class="preprocessor">#include "<a class="code" href="TermFieldStatistics_8hpp.html">indri/TermFieldStatistics.hpp</a>"</font>
00091 <font class="preprocessor">#include "<a class="code" href="KeyfileWordMap_8hpp.html">indri/KeyfileWordMap.hpp</a>"</font>
00092 <font class="preprocessor">#include "<a class="code" href="DocumentData_8hpp.html">indri/DocumentData.hpp</a>"</font>
00093 
00094 <font class="preprocessor">#include "<a class="code" href="CorpusStatistics_8hpp.html">indri/CorpusStatistics.hpp</a>"</font>
00095 <font class="preprocessor">#include "<a class="code" href="FieldStatistics_8hpp.html">indri/FieldStatistics.hpp</a>"</font>
00096 <font class="preprocessor">#include "<a class="code" href="FieldData_8hpp.html">indri/FieldData.hpp</a>"</font>
00097 <font class="preprocessor">#include "<a class="code" href="TermListBuilder_8hpp.html">indri/TermListBuilder.hpp</a>"</font>
00098 <font class="preprocessor">#include "<a class="code" href="FieldListIterator_8hpp.html">indri/FieldListIterator.hpp</a>"</font>
00099 <font class="preprocessor">#include "<a class="code" href="DocListFrequencyIterator_8hpp.html">indri/DocListFrequencyIterator.hpp</a>"</font>
00100 
00101 <font class="preprocessor">#include "<a class="code" href="TagExtent_8hpp.html">indri/TagExtent.hpp</a>"</font>
00102 
00103 
00104 <font class="keyword">struct </font><a class="code" href="structParsedDocument.html">ParsedDocument</a>;
00105 
<a name="l00106"></a><a class="code" href="IndriIndex_8hpp.html#a0">00106</a> <font class="preprocessor">#define INDRI_DEFAULT_QUERY_PROPORTION     (0.5)</font>
<a name="l00107"></a><a class="code" href="IndriIndex_8hpp.html#a1">00107</a> <font class="preprocessor"></font><font class="preprocessor">#define INDRI_DEFAULT_MEMORY_SIZE          (128*1024*1024)</font>
<a name="l00108"></a><a class="code" href="IndriIndex_8hpp.html#a2">00108</a> <font class="preprocessor"></font><font class="preprocessor">#define INDRI_OUTRAGEOUS_DOCLENGTH         (1000*1000*1000)</font>
00109 <font class="preprocessor"></font>
<a name="l00110"></a><a class="code" href="structless__string.html">00110</a> <font class="keyword">struct </font><a class="code" href="structless__string.html">less_string</a> {
<a name="l00111"></a><a class="code" href="structless__string.html#a0">00111</a>   <font class="keywordtype">bool</font> <a class="code" href="structless__string.html#a0">operator () </a>( <font class="keyword">const</font> <font class="keywordtype">char</font>* one, <font class="keyword">const</font> <font class="keywordtype">char</font>* two )<font class="keyword"> const </font>{
00112     <font class="keywordflow">return</font> strcmp( one, two ) &lt; 0;
00113   }
00114 };
00115 
<a name="l00118"></a><a class="code" href="classIndriIndex.html">00118</a> <font class="keyword">class </font><a class="code" href="classIndriIndex.html">IndriIndex</a> {
00119 <font class="keyword">private</font>:
<a name="l00120"></a><a class="code" href="structIndriIndex_1_1term__cache__entry.html">00120</a>   <font class="keyword">struct </font><a class="code" href="structIndriIndex_1_1term__cache__entry.html">term_cache_entry</a> {
<a name="l00121"></a><a class="code" href="structIndriIndex_1_1term__cache__entry.html#m0">00121</a>     TERMID_T <a class="code" href="structIndriIndex_1_1term__cache__entry.html#m0">termID</a>;
<a name="l00122"></a><a class="code" href="structIndriIndex_1_1term__cache__entry.html#m1">00122</a>     <a class="code" href="structindri_1_1index_1_1TermData.html">indri::index::TermData</a>* <a class="code" href="structIndriIndex_1_1term__cache__entry.html#m1">termData</a>;
<a name="l00123"></a><a class="code" href="structIndriIndex_1_1term__cache__entry.html#m2">00123</a>     <font class="keywordtype">char</font> <a class="code" href="structIndriIndex_1_1term__cache__entry.html#m2">term</a>[0];
00124   };
00125 
00126 <font class="keyword">public</font>:
<a name="l00128"></a><a class="code" href="structIndriIndex_1_1FieldDescription.html">00128</a>   <font class="keyword">struct </font><a class="code" href="structIndriIndex_1_1FieldDescription.html">FieldDescription</a> {
<a name="l00130"></a><a class="code" href="structIndriIndex_1_1FieldDescription.html#m0">00130</a>     std::string <a class="code" href="structIndriIndex_1_1FieldDescription.html#m0">name</a>;
<a name="l00132"></a><a class="code" href="structIndriIndex_1_1FieldDescription.html#m1">00132</a>     <font class="keywordtype">bool</font> <a class="code" href="structIndriIndex_1_1FieldDescription.html#m1">numeric</a>;
00133   };
00137   <a class="code" href="classIndriIndex.html#a0">IndriIndex</a>( size_t memorySize = <a class="code" href="IndriIndex_8hpp.html#a1">INDRI_DEFAULT_MEMORY_SIZE</a>, <font class="keywordtype">float</font> queryProportion = <a class="code" href="IndriIndex_8hpp.html#a0">INDRI_DEFAULT_QUERY_PROPORTION</a>);  
00138   <a class="code" href="classIndriIndex.html#a1">~IndriIndex</a>();
00139 
00141   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#a2">setName</a>(<font class="keyword">const</font> std::string&amp; prefix);
00145   DOCID_T <a class="code" href="classIndriIndex.html#a3">addDocument</a>( <font class="keyword">struct</font> <a class="code" href="structParsedDocument.html">ParsedDocument</a>* <a class="code" href="classIndriIndex.html#z1_2">document</a> );
00146 
00147   <font class="comment">// still support this call in the transition period</font>
00153 <font class="comment">  DOCID_T addDocument( const char* documentName, const greedy_vector&lt;char*&gt;&amp; words, const greedy_vector&lt;TagExtent&gt;&amp; tagExtents );</font>
00154 
00156 
00157 
00159   <font class="keywordtype">bool</font> <a class="code" href="classIndriIndex.html#z0_0">open</a>(<font class="keyword">const</font> std::string&amp; indexName);
00161   <font class="keywordtype">bool</font> <a class="code" href="classIndriIndex.html#z0_0">open</a>( <font class="keyword">const</font> <font class="keywordtype">char</font>* indexName );
00163   <font class="keywordtype">bool</font> <a class="code" href="classIndriIndex.html#z0_2">openRead</a>(<font class="keyword">const</font> std::string&amp; indexName);
00164 
00165 
00167   <font class="keywordtype">bool</font> <a class="code" href="classIndriIndex.html#z0_3">create</a>(<font class="keyword">const</font> std::string&amp; indexName );
00168 
00170   <font class="keywordtype">bool</font> <a class="code" href="classIndriIndex.html#z0_3">create</a>(<font class="keyword">const</font> std::string&amp; indexName, <font class="keyword">const</font> std::vector&lt;FieldDescription&gt;&amp; fields );
00172   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#z0_5">close</a>();
00173 
00175 
00177 
00178 
00180   TERMID_T <a class="code" href="classIndriIndex.html#z1_0">term</a>(<font class="keyword">const</font> TERM_T &amp;<a class="code" href="namespaceTaggedTextTokenType.html#a2">word</a>) <font class="keyword">const</font>;
00181 
00183   <font class="keyword">const</font> TERM_T <a class="code" href="classIndriIndex.html#z1_0">term</a>(TERMID_T termID) <font class="keyword">const</font>;
00184 
00186   DOCID_T <a class="code" href="classIndriIndex.html#z1_2">document</a>(<font class="keyword">const</font> EXDOCID_T &amp;docIDStr) <font class="keyword">const</font>;
00187 
00189   <font class="keyword">const</font> EXDOCID_T <a class="code" href="classIndriIndex.html#z1_2">document</a>(DOCID_T docID) <font class="keyword">const</font>; 
00190 
00192   <font class="keyword">const</font> <font class="keywordtype">char</font>* <a class="code" href="classIndriIndex.html#z1_4">field</a>(<font class="keywordtype">int</font> fieldID);
00193 
00195   <font class="keywordtype">int</font> <a class="code" href="classIndriIndex.html#z1_4">field</a>( <font class="keyword">const</font> <font class="keywordtype">char</font>* fieldName );
00196 
00198   <font class="keywordtype">int</font> <a class="code" href="classIndriIndex.html#z1_4">field</a>( <font class="keyword">const</font> std::string&amp; fieldName );
00199 
00201 
00203 
00204 
<a name="l00206"></a><a class="code" href="classIndriIndex.html#z2_0">00206</a>   COUNT_T <a class="code" href="classIndriIndex.html#z2_0">docCount</a>()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> <a class="code" href="classIndriIndex.html#n1">_corpusStatistics</a>.<a class="code" href="structindri_1_1index_1_1CorpusStatistics.html#m1">totalDocuments</a>; };
00207 
<a name="l00209"></a><a class="code" href="classIndriIndex.html#z2_1">00209</a>   COUNT_T <a class="code" href="classIndriIndex.html#z2_1">termCountUnique</a>()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> <a class="code" href="classIndriIndex.html#n1">_corpusStatistics</a>.<a class="code" href="structindri_1_1index_1_1CorpusStatistics.html#m2">uniqueTerms</a>; };
00210 
00212   INT64 <a class="code" href="classIndriIndex.html#z2_3">termCount</a>(TERMID_T termID) <font class="keyword">const</font>;
00213 
<a name="l00215"></a><a class="code" href="classIndriIndex.html#z2_3">00215</a>   INT64 <a class="code" href="classIndriIndex.html#z2_3">termCount</a>()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> <a class="code" href="classIndriIndex.html#n1">_corpusStatistics</a>.<a class="code" href="structindri_1_1index_1_1CorpusStatistics.html#m0">totalTerms</a>; };
00216 
00218   INT64 <a class="code" href="classIndriIndex.html#z2_4">fieldTermCount</a>(<font class="keywordtype">int</font> fieldID, TERMID_T termID) <font class="keyword">const</font>;
00219 
00221   INT64 <a class="code" href="classIndriIndex.html#z2_4">fieldTermCount</a>(<font class="keywordtype">int</font> fieldID) <font class="keyword">const</font>;
00222 
00224   INT64 <a class="code" href="classIndriIndex.html#z2_6">fieldDocCount</a>(<font class="keywordtype">int</font> fieldID) <font class="keyword">const</font>;
00225 
00227   INT64 <a class="code" href="classIndriIndex.html#z2_6">fieldDocCount</a>(<font class="keywordtype">int</font> fieldID, TERMID_T termID) <font class="keyword">const</font>;
00228 
00230   <font class="keywordtype">double</font> <a class="code" href="classIndriIndex.html#z2_8">docLengthAvg</a>() <font class="keyword">const</font>;
00231 
00233   COUNT_T <a class="code" href="classIndriIndex.html#z2_0">docCount</a>(TERMID_T termID) <font class="keyword">const</font>;
00235   COUNT_T <a class="code" href="classIndriIndex.html#z2_10">docIndexedLength</a>( DOCID_T documentID ) <font class="keyword">const</font>;
00237   COUNT_T <a class="code" href="classIndriIndex.html#z2_11">docLength</a>( DOCID_T documentID ) <font class="keyword">const</font>;
00238 
00240   <font class="keywordtype">int</font> <a class="code" href="classIndriIndex.html#z2_12">termMaxDocumentFrequency</a>( TERMID_T termID );
00241 
00243   <font class="keywordtype">int</font> <a class="code" href="classIndriIndex.html#z2_13">termMinDocumentLength</a>( TERMID_T termID );
00244 
00246   <font class="keywordtype">double</font> <a class="code" href="classIndriIndex.html#z2_14">termMaxDocumentFraction</a>( TERMID_T termID );
00247 
00249   <font class="keywordtype">int</font> <a class="code" href="classIndriIndex.html#z2_15">maxDocumentLength</a>();
00250 
00252 
00254   DocInfoList* <a class="code" href="classIndriIndex.html#a5">docInfoList</a>(TERMID_T termID) <font class="keyword">const</font>;
00256   <a class="code" href="classDocPositionInfoList.html">DocPositionInfoList</a>* <a class="code" href="classIndriIndex.html#a6">docPositionInfoList</a>(TERMID_T termID);
00258   <a class="code" href="classindri_1_1index_1_1DocListFrequencyIterator.html">indri::index::DocListFrequencyIterator</a>* <a class="code" href="classIndriIndex.html#a7">docFrequencyInfoList</a>(TERMID_T termID);
00259 
00261   TermInfoList* <a class="code" href="classIndriIndex.html#a8">termInfoList</a>(DOCID_T docID) <font class="keyword">const</font>;
00263   TermInfoList* <a class="code" href="classIndriIndex.html#a9">termInfoListSeq</a>(DOCID_T docID) <font class="keyword">const</font>;
00264 
00266   <a class="code" href="classindri_1_1index_1_1TermListBuilder.html">indri::index::TermListBuilder</a>* <a class="code" href="classIndriIndex.html#a10">termPositionList</a>(DOCID_T docID);
00267 
00269   <a class="code" href="classindri_1_1index_1_1FieldListIterator.html">indri::index::FieldListIterator</a>* <a class="code" href="classIndriIndex.html#a11">fieldPositionListIterator</a>( <font class="keywordtype">int</font> fieldID );
00270 
00271 <font class="keyword">protected</font>:
<a name="l00272"></a><a class="code" href="classIndriIndex.html#n0">00272</a>   <font class="keywordtype">bool</font> <a class="code" href="classIndriIndex.html#n0">_readOnly</a>;
00273 
00274   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b0">_writeCache</a>();
00275   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b1">_writeAndMerge</a>();
00276 
00277   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b2">_writeBatchSegment</a>();
00278   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b3">_mergeBatch</a>();
00279   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b4">_mergeBatchSegments</a>( <font class="keywordtype">int</font> start, <font class="keywordtype">int</font> end, <font class="keywordtype">int</font> newNumber, <font class="keywordtype">bool</font> finalMerge );
00280   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b5">_mergeBatchTermLists</a>( <font class="keyword">const</font> std::vector&lt;int&gt;&amp; segmentMapping );
00281   
00282   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b6">_writeIncrementalSegment</a>();
00283   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b7">_mergeIncrementalSegments</a>();
00284 
00285   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b8">_readTermMapping</a>( greedy_vector&lt;int&gt;&amp; mapping, <font class="keywordtype">int</font> segment, <font class="keywordtype">int</font> secondSegment );
00286 
00287   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b9">_openMergeFiles</a>( <font class="keywordtype">int</font> startSegment,
00288                         <font class="keywordtype">int</font> endSegment,
00289                         std::vector&lt;File*&gt;&amp; listFiles,
00290                         std::vector&lt;File*&gt;&amp; statsFiles,
00291                         std::vector&lt;File*&gt;&amp; mappingFiles,
00292                         std::vector&lt;WriteBuffer*&gt;&amp; mappingBuffers,
00293                         std::vector&lt;ReadBuffer*&gt;&amp; statsBuffers,
00294                         std::vector&lt;indri::index::DocListFileIterator*&gt;&amp; listIterators,
00295                         std::vector&lt;char*&gt;&amp; terms,
00296                         std::vector&lt;indri::index::TermData*&gt;&amp; termDatas,
00297                         <font class="keywordtype">bool</font> finalMerge );
00298 
00299   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b10">_openDBs</a>();
00300   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b11">_openReadOnlyDBs</a>();
00301   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b12">_openSegments</a>();
00302   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b13">_createDBs</a>();
00303   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b14">_createFields</a>( <font class="keyword">const</font> std::vector&lt;FieldDescription&gt;&amp; fieldNames );
00304   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b15">_closeFields</a>();
00305 
00306   <a class="code" href="structindri_1_1index_1_1DocumentData.html">indri::index::DocumentData</a> <a class="code" href="classIndriIndex.html#b16">fetchDocumentData</a>( <font class="keywordtype">int</font> key ) <font class="keyword">const</font>;
00307   <font class="keywordtype">int</font> <a class="code" href="classIndriIndex.html#b17">fetchDocumentLength</a>( <font class="keywordtype">int</font> key ) <font class="keyword">const</font>;
00308 
00309   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b18">_updateTermlist</a>( TERMID_T termID, <font class="keywordtype">int</font> position );
00310   <font class="keywordtype">int</font> <a class="code" href="classIndriIndex.html#b19">_updateTermData</a>( <font class="keywordtype">int</font> documentLength );
00311   size_t <a class="code" href="classIndriIndex.html#b20">_cacheSize</a>();
00312   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b21">_computeMemoryBounds</a>( size_t memorySize, <font class="keywordtype">float</font> queryProportion );
00313   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b22">_resetEstimatePoint</a>();
00314 
00315   <font class="comment">// special handling for term data, since it varies in size</font>
00316   <font class="comment">// based on the number of indexed fields</font>
00317   <a class="code" href="structindri_1_1index_1_1TermData.html">indri::index::TermData</a>* <a class="code" href="classIndriIndex.html#b23">_createTermData</a>();
00318   <a class="code" href="structindri_1_1index_1_1TermData.html">indri::index::TermData</a>* <a class="code" href="classIndriIndex.html#b24">_fetchTermData</a>(TERMID_T termID);
00319   <a class="code" href="structindri_1_1index_1_1TermData.html">indri::index::TermData</a>* <a class="code" href="classIndriIndex.html#b25">_lookupTermData</a>(TERMID_T termID);
00320   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b26">_cleanCache</a>();
00321   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b27">_deleteTermData</a>( <a class="code" href="structindri_1_1index_1_1TermData.html">indri::index::TermData</a>* termData );
00322   size_t <a class="code" href="classIndriIndex.html#b28">_sizeTermData</a>();
00323   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b29">_clearTermData</a>();
00324 
00325   <font class="comment">// special handling for cache data</font>
00326   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b30">_clearTermCache</a>();
00327   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b31">_storeTermCache</a>( <font class="keyword">const</font> <font class="keywordtype">char</font>* <a class="code" href="classIndriIndex.html#z1_0">term</a>, TERMID_T termID, <a class="code" href="structindri_1_1index_1_1TermData.html">indri::index::TermData</a>*&amp; termData );
00328 
00329   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b32">_flushTermStatistics</a>( TERMID_T termID, <font class="keyword">const</font> <a class="code" href="structindri_1_1index_1_1TermFieldStatistics.html">indri::index::TermFieldStatistics</a>&amp; statistics );
00330   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b33">_addTermDataToBuilder</a>( <a class="code" href="classindri_1_1index_1_1DocListDiskBuilder.html">indri::index::DocListDiskBuilder</a>&amp; builder, <a class="code" href="classindri_1_1index_1_1DocListFileIterator.html">indri::index::DocListFileIterator</a>&amp; iterator, <font class="keywordtype">int</font> writingID, <font class="keywordtype">int</font> readingID );
00331 
00332   <font class="comment">// addDocument helpers</font>
00333   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b34">_addOpenTags</a>( greedy_vector&lt;indri::index::FieldExtent&gt;&amp; indexedTags,
00334                      greedy_vector&lt;indri::index::FieldExtent&gt;&amp; openTags,
00335                      <font class="keyword">const</font> greedy_vector&lt;TagExtent&gt;&amp; extents,
00336                      <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>&amp; extentIndex,
00337                      <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> position );
00338   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b35">_removeClosedTags</a>( greedy_vector&lt;indri::index::FieldExtent&gt;&amp; tags, <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> position );
00339   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b36">_lookupTerm</a>( <font class="keyword">const</font> <font class="keywordtype">char</font>* <a class="code" href="classIndriIndex.html#z1_0">term</a>, TERMID_T&amp; termID, <a class="code" href="structindri_1_1index_1_1TermData.html">indri::index::TermData</a>*&amp; termData );
00340   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b37">_finishDocument</a>( greedy_vector&lt;indri::index::TermFieldStatistics*&gt;&amp; seenStatistics );
00341   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b38">_writeDocumentTermList</a>( File::offset_type&amp; offset, <font class="keywordtype">int</font>&amp; byteLength, DOCID_T documentID, <font class="keywordtype">int</font> documentLength, <a class="code" href="classindri_1_1index_1_1TermListBuilder.html">indri::index::TermListBuilder</a>&amp; locatedTerms );
00342   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b39">_writeDocumentStatistics</a>( File::offset_type offset, <font class="keywordtype">int</font> byteLength, <font class="keywordtype">int</font> indexedLength, <font class="keywordtype">int</font> totalLength, <font class="keywordtype">int</font> uniqueTerms );
00343   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b40">_handleCache</a>();
00344   <font class="keywordtype">int</font> <a class="code" href="classIndriIndex.html#b41">_lookupTag</a>( <font class="keyword">const</font> <font class="keywordtype">char</font>* <a class="code" href="namespaceTaggedTextTokenType.html#a0">tag</a> );
00345 
00346   <font class="keywordtype">bool</font> <a class="code" href="classIndriIndex.html#b42">_readTermData</a>( TERMID_T&amp; termID, <font class="keywordtype">char</font>* termBuffer, <a class="code" href="structindri_1_1index_1_1TermData.html">indri::index::TermData</a>* termData, ReadBuffer* termDataFile );
00347   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b43">_incrementalWriteTermData</a>( TERMID_T termID, <a class="code" href="structindri_1_1index_1_1TermData.html">indri::index::TermData</a>* termData );
00348   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b44">_batchWriteTermData</a>( TERMID_T termID, <a class="code" href="structindri_1_1index_1_1TermData.html">indri::index::TermData</a>* termData, WriteBuffer* file );
00349   <font class="keywordtype">int</font> <a class="code" href="classIndriIndex.html#b45">_compressTermData</a>( <font class="keywordtype">char</font>* buffer, <font class="keywordtype">int</font> size, <a class="code" href="structindri_1_1index_1_1TermData.html">indri::index::TermData</a>* termData );
00350   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b46">_decompressTermData</a>( <font class="keyword">const</font> <font class="keywordtype">char</font>* buffer, <font class="keywordtype">int</font> size, <a class="code" href="structindri_1_1index_1_1TermData.html">indri::index::TermData</a>* termData );
00351 
00352   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b47">_writeParameters</a>( <font class="keyword">const</font> std::string&amp; fileName );
00353   <font class="keywordtype">bool</font> <a class="code" href="classIndriIndex.html#b48">_readParameters</a>( <font class="keyword">const</font> std::string&amp; fileName );
00354 
00355   
00356   <font class="keywordtype">void</font> <a class="code" href="classIndriIndex.html#b49">_openDocumentFiles</a>();
00357   std::string <a class="code" href="classIndriIndex.html#b50">_buildFileName</a>( <font class="keyword">const</font> <font class="keywordtype">char</font>* suffix );
00358   std::string <a class="code" href="classIndriIndex.html#b50">_buildFileName</a>( <font class="keyword">const</font> <font class="keywordtype">char</font>* suffix, <font class="keywordtype">int</font> index );
00359 
00360   <font class="comment">// count statistics</font>
<a name="l00361"></a><a class="code" href="classIndriIndex.html#n1">00361</a>   <a class="code" href="structindri_1_1index_1_1CorpusStatistics.html">indri::index::CorpusStatistics</a> <a class="code" href="classIndriIndex.html#n1">_corpusStatistics</a>;
<a name="l00362"></a><a class="code" href="classIndriIndex.html#n2">00362</a>   std::vector&lt;indri::index::FieldData*&gt; <a class="code" href="classIndriIndex.html#n2">_fieldData</a>;
<a name="l00363"></a><a class="code" href="classIndriIndex.html#n3">00363</a>   std::map&lt;const char*, int, less_string&gt; <a class="code" href="classIndriIndex.html#n3">_fieldLookup</a>;
00364 
00365   <font class="comment">// General index parameters and state</font>
<a name="l00366"></a><a class="code" href="classIndriIndex.html#n4">00366</a>   std::string <a class="code" href="classIndriIndex.html#n4">_baseName</a>;    
<a name="l00367"></a><a class="code" href="classIndriIndex.html#n5">00367</a>   <font class="keywordtype">bool</font> <a class="code" href="classIndriIndex.html#n5">_writingDocTermLists</a>;
00368 
00369   <font class="comment">// ---- Disk-based structures --------------------</font>
00370 
00371   <font class="comment">// All database handles are marked mutable since they sometimes</font>
00372   <font class="comment">// must be used to fetch values during const methods</font>
<a name="l00373"></a><a class="code" href="classIndriIndex.html#n6">00373</a>   <font class="keyword">mutable</font> Keyfile <a class="code" href="classIndriIndex.html#n6">_termDataStore</a>;         <font class="comment">// termID -&gt; indri::index::TermData (term statistics and inverted list segment offsets)</font>
<a name="l00374"></a><a class="code" href="classIndriIndex.html#n7">00374</a>   <font class="keyword">mutable</font> <a class="code" href="classKeyfileWordMap.html">KeyfileWordMap</a> <a class="code" href="classIndriIndex.html#n7">_documentMap</a>;    <font class="comment">// documentID &lt;-&gt; documentString</font>
<a name="l00375"></a><a class="code" href="classIndriIndex.html#n8">00375</a>   <font class="keyword">mutable</font> <a class="code" href="classKeyfileWordMap.html">KeyfileWordMap</a> <a class="code" href="classIndriIndex.html#n8">_termMap</a>;        <font class="comment">// termID &lt;-&gt; termString</font>
<a name="l00376"></a><a class="code" href="classIndriIndex.html#n9">00376</a>   <font class="keyword">mutable</font> File* <a class="code" href="classIndriIndex.html#n9">_documentStatisticsFile</a>;  <font class="comment">// document statistics (document length, etc.)</font>
<a name="l00377"></a><a class="code" href="classIndriIndex.html#n10">00377</a>   <font class="keyword">mutable</font> File <a class="code" href="classIndriIndex.html#n10">_documentLengthFile</a>;       <font class="comment">// document length only</font>
00378 
<a name="l00379"></a><a class="code" href="classIndriIndex.html#n11">00379</a>   std::vector&lt;File*&gt; <a class="code" href="classIndriIndex.html#n11">_segments</a>;           <font class="comment">// inverted list segment files</font>
<a name="l00380"></a><a class="code" href="classIndriIndex.html#n12">00380</a>   <font class="keywordtype">int</font> <a class="code" href="classIndriIndex.html#n12">_batchSegmentCount</a>;                 <font class="comment">// count of segments</font>
<a name="l00381"></a><a class="code" href="classIndriIndex.html#n13">00381</a>   File* <a class="code" href="classIndriIndex.html#n13">_documentTermLocationsFile</a>;       <font class="comment">// filestream for writing the list of located terms</font>
00382 
00383   <font class="comment">// ---- Current document structures --------------</font>
00384   <font class="comment">//    (since IndriIndex is now doc-at-a-time, the main reason for keeping</font>
00385   <font class="comment">//    these here is to reduce allocation overhead)</font>
00386 
<a name="l00387"></a><a class="code" href="classIndriIndex.html#n14">00387</a>   <a class="code" href="classindri_1_1index_1_1TermListBuilder.html">indri::index::TermListBuilder</a> <a class="code" href="classIndriIndex.html#n14">_termList</a>;
<a name="l00388"></a><a class="code" href="classIndriIndex.html#n15">00388</a>   <a class="code" href="classBuffer.html">Buffer</a> <a class="code" href="classIndriIndex.html#n15">_termListBuffer</a>;
00389 
<a name="l00390"></a><a class="code" href="classIndriIndex.html#n16">00390</a>   greedy_vector&lt;indri::index::TermData*&gt; <a class="code" href="classIndriIndex.html#n16">_seenTerms</a>;
00391 
00392   <font class="comment">// ---- Cache structures -------------------------</font>
<a name="l00393"></a><a class="code" href="classIndriIndex.html#n17">00393</a>   <a class="code" href="classHashTable.html">HashTable&lt;int, indri::index::TermData*&gt;</a>* <a class="code" href="classIndriIndex.html#n17">_termDataTable</a>; 
<a name="l00394"></a><a class="code" href="classIndriIndex.html#n18">00394</a>   <a class="code" href="classHashTable.html">HashTable&lt;const char*, term_cache_entry*&gt;</a>* <a class="code" href="classIndriIndex.html#n18">_cache</a>;
00395 
<a name="l00396"></a><a class="code" href="classIndriIndex.html#n19">00396</a>   ReadBuffer* <a class="code" href="classIndriIndex.html#n19">_documentStatisticsBuffer</a>; <font class="comment">// read buffer for document stats</font>
<a name="l00397"></a><a class="code" href="classIndriIndex.html#n20">00397</a>   ReadBuffer* <a class="code" href="classIndriIndex.html#n20">_documentLengthBuffer</a>;     <font class="comment">// read buffer for document length</font>
00398 
00399   <font class="comment">// ---- Memory/cache management parameters -------</font>
<a name="l00400"></a><a class="code" href="classIndriIndex.html#n21">00400</a>   size_t <a class="code" href="classIndriIndex.html#n21">_listsSize</a>; <font class="comment">// memory for use by inverted list buffers</font>
<a name="l00401"></a><a class="code" href="classIndriIndex.html#n22">00401</a>   size_t <a class="code" href="classIndriIndex.html#n22">_memorySize</a>; <font class="comment">// upper bound for memory use</font>
<a name="l00402"></a><a class="code" href="classIndriIndex.html#n23">00402</a>   size_t <a class="code" href="classIndriIndex.html#n23">_termDataSize</a>; <font class="comment">// memory bound for termdata</font>
<a name="l00403"></a><a class="code" href="classIndriIndex.html#n24">00403</a>   size_t <a class="code" href="classIndriIndex.html#n24">_termCacheSize</a>; <font class="comment">// memory bound for termcache</font>
<a name="l00404"></a><a class="code" href="classIndriIndex.html#n25">00404</a>   size_t <a class="code" href="classIndriIndex.html#n25">_statisticsBufferSize</a>; <font class="comment">// memory bound for _documentStatisticsBuffer</font>
<a name="l00405"></a><a class="code" href="classIndriIndex.html#n26">00405</a>   size_t <a class="code" href="classIndriIndex.html#n26">_lengthBufferSize</a>; <font class="comment">// memory bound for _documentLengthBuffer</font>
<a name="l00406"></a><a class="code" href="classIndriIndex.html#n27">00406</a>   <font class="keywordtype">float</font> <a class="code" href="classIndriIndex.html#n27">_queryProportion</a>; <font class="comment">// proportion of load assumed to be queries</font>
<a name="l00407"></a><a class="code" href="classIndriIndex.html#n28">00407</a>   <font class="keywordtype">bool</font> <a class="code" href="classIndriIndex.html#n28">_batchBuild</a>;
00408 
<a name="l00409"></a><a class="code" href="classIndriIndex.html#n29">00409</a>   INT64 <a class="code" href="classIndriIndex.html#n29">_estimatePoint</a>;  
<a name="l00410"></a><a class="code" href="classIndriIndex.html#n30">00410</a>   INT64 <a class="code" href="classIndriIndex.html#n30">_lastCacheFlush</a>; 
00411 };
00412 
00413 
00414 <font class="preprocessor">#endif // INDRI_INDEX_HPP</font>
00415 <font class="preprocessor"></font>
</pre></div><hr><address align="right"><small>Generated on Tue Nov 16 15:17:21 2004 for INDRI by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.16 </small></address>
</body>
</html>
